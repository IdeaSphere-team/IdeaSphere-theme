{% extends "admin/base.html" %}

{% block title %}版块管理 - IdeaSphere 管理后台{% endblock %}

{% block head_extra %}
<link href="{{ url_for('static', filename='css/admin-posts.css') }}" rel="stylesheet">
{% endblock %}

{% block custom_css %}
/* 确保这些样式只影响主内容区域，不影响侧边栏 */
.admin-main .stats-cards {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 1.5rem;
    margin-bottom: 2rem;
}

.admin-main .stat-card {
    background-color: white;
    border-radius: 12px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    padding: 1.5rem;
    display: flex;
    align-items: center;
    justify-content: space-between;
}

.admin-main .stat-card-icon {
    width: 48px;
    height: 48px;
    border-radius: 12px;
    background-color: rgba(45, 206, 137, 0.1);
    color: #2dce89;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 20px;
}

.admin-main .stat-card-content {
    flex: 1;
    margin-left: 1rem;
}

.admin-main .stat-card-value {
    font-size: 1.75rem;
    font-weight: 600;
    color: #344767;
    margin-bottom: 0.25rem;
}

.admin-main .stat-card-label {
    font-size: 0.875rem;
    color: #67748e;
}

.admin-main .function-bar {
    display: flex;
    flex-wrap: wrap;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 1.5rem;
    gap: 1rem;
    background-color: white;
    border-radius: 12px;
    padding: 1rem;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
}

.admin-main .search-box {
    position: relative;
    flex: 1;
    min-width: 240px;
}

.admin-main .search-box input {
    padding: 0.625rem 1rem 0.625rem 2.5rem;
    border: 1px solid #e9ecef;
    border-radius: 8px;
    width: 100%;
}

.admin-main .search-box i {
    position: absolute;
    left: 1rem;
    top: 50%;
    transform: translateY(-50%);
    color: #a0aec0;
}

.admin-main .filters {
    display: flex;
    gap: 0.75rem;
}

.admin-main .dropdown {
    position: relative;
}

.admin-main .dropdown-toggle {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.625rem 1rem;
    border: 1px solid #e9ecef;
    border-radius: 8px;
    background-color: white;
    cursor: pointer;
    transition: all 0.2s ease;
}

.admin-main .dropdown:hover .dropdown-menu {
    display: block;
}

.admin-main .dropdown-menu {
    display: none;
    position: absolute;
    top: 100%;
    right: 0;
    min-width: 180px;
    background-color: white;
    border-radius: 8px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    padding: 0.5rem 0;
    z-index: 100;
}

.admin-main .dropdown-item {
    display: block;
    padding: 0.5rem 1rem;
    color: #67748e;
    text-decoration: none;
    transition: all 0.2s ease;
}

.admin-main .dropdown-item:hover {
    background-color: #f8f9fa;
}

.admin-main .dropdown-item.active {
    background-color: #263849;
    color: white;
}

.admin-main .actions {
    margin-left: auto;
}

.admin-main .section-cards {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 1.5rem;
}

.admin-main .section-card {
    background-color: white;
    border-radius: 12px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
    overflow: hidden;
    transition: all 0.3s ease;
}

.admin-main .section-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 15px rgba(0, 0, 0, 0.1);
}

.admin-main .section-card-header {
    padding: 1.25rem;
    display: flex;
    align-items: center;
    justify-content: space-between;
    border-bottom: 1px solid #e9ecef;
}

.admin-main .section-icon {
    width: 48px;
    height: 48px;
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 20px;
    color: white;
}

.admin-main .section-header-actions {
    display: flex;
    gap: 0.5rem;
}

.admin-main .action-btn {
    width: 32px;
    height: 32px;
    border-radius: 8px;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    color: #67748e;
    background-color: #f8f9fa;
    border: none;
    cursor: pointer;
    transition: all 0.2s ease;
}

.admin-main .action-btn:hover {
    background-color: #e9ecef;
    color: #344767;
}

.admin-main .action-btn.delete-section-btn:hover {
    background-color: #fb634010;
    color: #fb6340;
}

.admin-main .section-card-body {
    padding: 1.25rem;
}

.admin-main .section-title {
    font-size: 1.25rem;
    font-weight: 600;
    color: #344767;
    margin-bottom: 0.5rem;
}

.admin-main .section-description {
    font-size: 0.875rem;
    color: #67748e;
    margin-bottom: 1rem;
    height: 40px;
    overflow: hidden;
    text-overflow: ellipsis;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
}

.admin-main .section-stats {
    display: flex;
    flex-wrap: wrap;
    gap: 1rem;
    margin-bottom: 1rem;
}

.admin-main .stat-item {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.875rem;
    color: #67748e;
}

.admin-main .section-status {
    display: flex;
    align-items: center;
    justify-content: space-between;
}

.admin-main .status-badge {
    display: inline-block;
    padding: 0.25rem 0.75rem;
    border-radius: 50px;
    font-size: 0.75rem;
    font-weight: 600;
}

.admin-main .status-active {
    background-color: rgba(45, 206, 137, 0.1);
    color: #2dce89;
}

.admin-main .status-inactive {
    background-color: rgba(251, 99, 64, 0.1);
    color: #fb6340;
}

.admin-main .sort-order {
    font-size: 0.75rem;
    color: #8392ab;
}

.admin-main .section-card-footer {
    padding: 1rem 1.25rem;
    background-color: #f8f9fa;
    display: flex;
    justify-content: space-between;
    border-top: 1px solid #e9ecef;
}

.admin-main .no-sections {
    grid-column: 1 / -1;
    background-color: white;
    border-radius: 12px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
    padding: 3rem;
    text-align: center;
}

.admin-main .no-data-icon {
    width: 80px;
    height: 80px;
    border-radius: 50%;
    background-color: #f8f9fa;
    color: #8392ab;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 32px;
    margin: 0 auto 1.5rem;
}

.admin-main .modal-content {
    border-radius: 12px;
    overflow: hidden;
    border: none;
}

.admin-main .modal-header {
    padding: 1.25rem 1.5rem;
    background-color: white;
    border-bottom: 1px solid #e9ecef;
}

.admin-main .modal-title {
    font-weight: 600;
    color: #344767;
    display: flex;
    align-items: center;
    gap: 0.75rem;
}

.admin-main .analytics-header {
    display: flex;
    justify-content: space-between;
    margin-bottom: 1.5rem;
}

.admin-main .time-range {
    display: flex;
    gap: 0.5rem;
}

.admin-main .analytics-cards {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 1.5rem;
    margin-bottom: 1.5rem;
}

@media (max-width: 991px) {
    .admin-main .stats-cards {
        grid-template-columns: repeat(2, 1fr);
    }
    
    .admin-main .analytics-cards {
        grid-template-columns: 1fr;
    }
}

@media (max-width: 767px) {
    .admin-main .stats-cards {
        grid-template-columns: 1fr;
    }
    
    .admin-main .function-bar {
        flex-direction: column;
        align-items: stretch;
    }
    
    .admin-main .section-cards {
        grid-template-columns: 1fr;
    }
}
{% endblock %}

{% block header_title %}版块管理{% endblock %}

{% block content %}
<!-- 数据统计卡片 -->
<div class="stats-cards">
    <div class="stat-card">
        <div class="stat-card-icon">
            <i class="fas fa-layer-group"></i>
        </div>
        <div class="stat-card-content">
            <div class="stat-card-value">{{ sections|length }}</div>
            <div class="stat-card-label">版块总数</div>
        </div>
        <div class="stat-card-chart">
            <i class="fas fa-chart-line"></i>
        </div>
    </div>
    
    <div class="stat-card">
        <div class="stat-card-icon">
            <i class="fas fa-eye"></i>
        </div>
        <div class="stat-card-content">
            <div class="stat-card-value">{{ sections|selectattr('is_active', 'equalto', true)|list|length }}</div>
            <div class="stat-card-label">可见版块</div>
        </div>
        <div class="stat-card-chart">
            <i class="fas fa-percentage"></i>
        </div>
    </div>
    
    <div class="stat-card">
        <div class="stat-card-icon">
            <i class="fas fa-file-alt"></i>
        </div>
        <div class="stat-card-content">
            <div class="stat-card-value">{{ sections|map(attribute='post_count')|sum }}</div>
            <div class="stat-card-label">总帖子数</div>
        </div>
        <div class="stat-card-chart">
            <i class="fas fa-chart-bar"></i>
        </div>
    </div>
    
    <div class="stat-card">
        <div class="stat-card-icon">
            <i class="fas fa-comments"></i>
        </div>
        <div class="stat-card-content">
            <div class="stat-card-value">{{ sections|map(attribute='comment_count')|sum }}</div>
            <div class="stat-card-label">总评论数</div>
        </div>
        <div class="stat-card-chart">
            <i class="fas fa-chart-area"></i>
        </div>
    </div>
</div>

<!-- 功能区和搜索 -->
<div class="function-bar">
    <div class="search-box">
        <input type="text" id="sectionSearch" placeholder="搜索版块...">
        <i class="fas fa-search"></i>
    </div>
    
    <div class="filters">
        <div class="dropdown">
            <button class="btn btn-light dropdown-toggle" type="button" id="filterDropdown">
                <i class="fas fa-filter"></i> 过滤
            </button>
            <div class="dropdown-menu">
                <a class="dropdown-item active" data-filter="all">全部版块</a>
                <a class="dropdown-item" data-filter="active">可见版块</a>
                <a class="dropdown-item" data-filter="inactive">隐藏版块</a>
            </div>
        </div>
        
        <div class="dropdown">
            <button class="btn btn-light dropdown-toggle" type="button" id="sortDropdown">
                <i class="fas fa-sort"></i> 排序
            </button>
            <div class="dropdown-menu">
                <a class="dropdown-item active" data-sort="order-asc">按排序值 (升序)</a>
                <a class="dropdown-item" data-sort="order-desc">按排序值 (降序)</a>
                <a class="dropdown-item" data-sort="name-asc">按名称 (A-Z)</a>
                <a class="dropdown-item" data-sort="name-desc">按名称 (Z-A)</a>
                <a class="dropdown-item" data-sort="posts-desc">按帖子数 (多到少)</a>
                <a class="dropdown-item" data-sort="date-desc">按创建日期 (新到旧)</a>
            </div>
        </div>
    </div>

    <div class="actions">
        <button class="btn btn-primary" data-toggle="modal" data-target="#addSectionModal">
            <i class="fas fa-plus"></i> 创建新版块
        </button>
    </div>
</div>

<!-- 版块卡片列表 -->
<div class="section-cards">
    {% for section in sections %}
    <div class="section-card fade-in" data-id="{{ section.id }}" data-name="{{ section.name }}" data-posts="{{ section.post_count }}" data-order="{{ section.sort_order }}" data-status="{{ section.is_active }}">
        <div class="section-card-header">
            <div class="section-icon" style="background-color: {{ section.icon_color }}">
                <i class="fas fa-{{ section.icon }}"></i>
            </div>
            <div class="section-header-actions">
                <button class="action-btn edit-section-btn" title="编辑版块" data-id="{{ section.id }}">
                    <i class="fas fa-edit"></i>
                </button>
                {% if section.is_active %}
                <button class="action-btn deactivate-section-btn" title="隐藏版块" data-id="{{ section.id }}">
                    <i class="fas fa-eye-slash"></i>
                </button>
                {% else %}
                <button class="action-btn activate-section-btn" title="显示版块" data-id="{{ section.id }}">
                    <i class="fas fa-eye"></i>
                </button>
                {% endif %}
                <button class="action-btn delete-section-btn" title="删除版块" data-id="{{ section.id }}">
                    <i class="fas fa-trash-alt"></i>
                </button>
            </div>
        </div>
        <div class="section-card-body">
            <h3 class="section-title">{{ section.name }}</h3>
            <p class="section-description">{{ section.description }}</p>
            
            <div class="section-stats">
                <div class="stat-item">
                    <i class="fas fa-file-alt"></i>
                    <span>{{ section.post_count }} 帖子</span>
                </div>
                <div class="stat-item">
                    <i class="fas fa-comments"></i>
                    <span>{{ section.comment_count }} 评论</span>
                </div>
                <div class="stat-item">
                    <i class="fas fa-clock"></i>
                    <span>{{ section.created_at.strftime('%Y-%m-%d') }}</span>
                </div>
            </div>
            
            <div class="section-status">
                <span class="status-badge {% if section.is_active %}status-active{% else %}status-inactive{% endif %}">
                    {% if section.is_active %}可见{% else %}隐藏{% endif %}
                </span>
                <span class="sort-order">排序: {{ section.sort_order }}</span>
            </div>
        </div>
        <div class="section-card-footer">
            <a href="{{ url_for('section_detail', section_id=section.id) }}" class="btn btn-light btn-sm" target="_blank">
                <i class="fas fa-external-link-alt"></i> 前台查看
            </a>
            <button class="btn btn-primary btn-sm section-stats-btn" data-id="{{ section.id }}">
                <i class="fas fa-chart-pie"></i> 数据分析
            </button>
        </div>
    </div>
    {% else %}
    <div class="no-sections">
        <div class="no-data-icon">
            <i class="fas fa-layer-group"></i>
        </div>
        <h3>暂无版块</h3>
        <p>点击上方"创建新版块"按钮开始创建</p>
    </div>
    {% endfor %}
</div>

<!-- 版块统计模态框 -->
<div class="modal fade" id="sectionStatsModal" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title"><i class="fas fa-chart-pie"></i> <span id="statsModalTitle">版块数据分析</span></h4>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true"><i class="fas fa-times"></i></span>
                </button>
            </div>
            <div class="modal-body">
                <div class="section-analytics">
                    <div class="analytics-header">
                        <div class="time-range">
                            <button class="btn btn-sm btn-light active" data-range="7">最近7天</button>
                            <button class="btn btn-sm btn-light" data-range="30">最近30天</button>
                            <button class="btn btn-sm btn-light" data-range="90">最近90天</button>
                            <button class="btn btn-sm btn-light" data-range="365">最近一年</button>
                        </div>
                    </div>
                    
                    <div class="analytics-cards">
                        <div class="analytics-card">
                            <div class="analytics-card-icon">
                                <i class="fas fa-eye"></i>
                            </div>
                            <div class="analytics-card-content">
                                <div class="analytics-card-value">1,245</div>
                                <div class="analytics-card-label">总浏览量</div>
                            </div>
                            <div class="analytics-card-change positive">
                                <i class="fas fa-arrow-up"></i> 12%
                            </div>
                        </div>
                        
                        <div class="analytics-card">
                            <div class="analytics-card-icon">
                                <i class="fas fa-file-alt"></i>
                            </div>
                            <div class="analytics-card-content">
                                <div class="analytics-card-value">48</div>
                                <div class="analytics-card-label">新发布帖子</div>
                            </div>
                            <div class="analytics-card-change positive">
                                <i class="fas fa-arrow-up"></i> 5%
                            </div>
                        </div>
                        
                        <div class="analytics-card">
                            <div class="analytics-card-icon">
                                <i class="fas fa-comments"></i>
                            </div>
                            <div class="analytics-card-content">
                                <div class="analytics-card-value">156</div>
                                <div class="analytics-card-label">新增评论</div>
                            </div>
                            <div class="analytics-card-change negative">
                                <i class="fas fa-arrow-down"></i> 3%
                            </div>
                        </div>
                        
                        <div class="analytics-card">
                            <div class="analytics-card-icon">
                                <i class="fas fa-users"></i>
                            </div>
                            <div class="analytics-card-content">
                                <div class="analytics-card-value">28</div>
                                <div class="analytics-card-label">活跃用户</div>
                            </div>
                            <div class="analytics-card-change positive">
                                <i class="fas fa-arrow-up"></i> 8%
                            </div>
                        </div>
                    </div>
                    
                    <div class="analytics-charts">
                        <div class="chart-container">
                            <h5 class="chart-title">发帖趋势</h5>
                            <div class="chart" id="postsChart">
                                <div class="chart-placeholder">
                                    <i class="fas fa-chart-line"></i>
                                    <span>加载中...</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="chart-container">
                            <h5 class="chart-title">用户活跃度</h5>
                            <div class="chart" id="usersChart">
                                <div class="chart-placeholder">
                                    <i class="fas fa-chart-bar"></i>
                                    <span>加载中...</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-light" data-dismiss="modal">关闭</button>
                <button type="button" class="btn btn-primary export-stats-btn">
                    <i class="fas fa-download"></i> 导出数据
                </button>
            </div>
        </div>
    </div>
</div>

<!-- 添加版块模态框 -->
<div class="modal fade" id="addSectionModal" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title"><i class="fas fa-layer-group"></i> 创建新版块</h4>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true"><i class="fas fa-times"></i></span>
                </button>
            </div>
            <div class="modal-body">
                <form id="addSectionForm" action="{{ url_for('create_section') }}" method="POST">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                    
                    <div class="form-group">
                        <label for="name" class="form-label">版块名称</label>
                        <input type="text" id="name" name="name" class="form-control" required placeholder="输入版块名称...">
                    </div>
                    
                    <div class="form-group">
                        <label for="description" class="form-label">描述</label>
                        <textarea id="description" name="description" class="form-control" rows="3" required placeholder="描述版块的主题和用途..."></textarea>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group col-md-6">
                            <label for="icon" class="form-label">图标</label>
                            <div class="icon-selector">
                                <div class="selected-icon" id="selectedIcon">
                                    <i class="fas fa-layer-group"></i>
                                </div>
                                <input type="hidden" id="icon" name="icon" value="layer-group">
                                <button type="button" class="btn btn-light" id="selectIconBtn">
                                    <i class="fas fa-chevron-down"></i>
                                </button>
                            </div>
                            <div class="icon-popup" id="iconPopup">
                                <div class="icon-search">
                                    <input type="text" placeholder="搜索图标..." id="iconSearchInput">
                                </div>
                                <div class="icon-grid">
                                    <div class="icon-item" data-icon="layer-group">
                                        <i class="fas fa-layer-group"></i>
                                    </div>
                                    <div class="icon-item" data-icon="comments">
                                        <i class="fas fa-comments"></i>
                                    </div>
                                    <div class="icon-item" data-icon="code">
                                        <i class="fas fa-code"></i>
                                    </div>
                                    <div class="icon-item" data-icon="book">
                                        <i class="fas fa-book"></i>
                                    </div>
                                    <div class="icon-item" data-icon="laptop-code">
                                        <i class="fas fa-laptop-code"></i>
                                    </div>
                                    <div class="icon-item" data-icon="lightbulb">
                                        <i class="fas fa-lightbulb"></i>
                                    </div>
                                    <div class="icon-item" data-icon="users">
                                        <i class="fas fa-users"></i>
                                    </div>
                                    <div class="icon-item" data-icon="graduation-cap">
                                        <i class="fas fa-graduation-cap"></i>
                                    </div>
                                    <div class="icon-item" data-icon="coffee">
                                        <i class="fas fa-coffee"></i>
                                    </div>
                                    <div class="icon-item" data-icon="gamepad">
                                        <i class="fas fa-gamepad"></i>
                                    </div>
                                    <div class="icon-item" data-icon="chart-line">
                                        <i class="fas fa-chart-line"></i>
                                    </div>
                                    <div class="icon-item" data-icon="paint-brush">
                                        <i class="fas fa-paint-brush"></i>
                                    </div>
                                    <div class="icon-item" data-icon="music">
                                        <i class="fas fa-music"></i>
                                    </div>
                                    <div class="icon-item" data-icon="camera">
                                        <i class="fas fa-camera"></i>
                                    </div>
                                    <div class="icon-item" data-icon="film">
                                        <i class="fas fa-film"></i>
                                    </div>
                                    <div class="icon-item" data-icon="globe">
                                        <i class="fas fa-globe"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-group col-md-6">
                            <label for="iconColor" class="form-label">颜色</label>
                            <div class="color-selector">
                                <div class="selected-color" id="selectedColor" style="background-color: #5e72e4;"></div>
                                <input type="hidden" id="iconColor" name="icon_color" value="#5e72e4">
                                <div class="color-options">
                                    <div class="color-option" data-color="#5e72e4" style="background-color: #5e72e4;"></div>
                                    <div class="color-option" data-color="#2dce89" style="background-color: #2dce89;"></div>
                                    <div class="color-option" data-color="#fb6340" style="background-color: #fb6340;"></div>
                                    <div class="color-option" data-color="#11cdef" style="background-color: #11cdef;"></div>
                                    <div class="color-option" data-color="#f5365c" style="background-color: #f5365c;"></div>
                                    <div class="color-option" data-color="#8965e0" style="background-color: #8965e0;"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="sort_order" class="form-label">排序</label>
                        <input type="number" id="sort_order" name="sort_order" class="form-control" value="0" min="0">
                        <small class="form-text text-muted">数字越小排序越靠前</small>
                    </div>
                    
                    <div class="form-group">
                        <div class="custom-control custom-switch">
                            <input type="checkbox" class="custom-control-input" id="is_active" name="is_active" checked>
                            <label class="custom-control-label" for="is_active">启用此版块</label>
                        </div>
                    </div>
                    
                    <div class="form-actions">
                        <button type="button" class="btn btn-light" data-dismiss="modal">取消</button>
                        <button type="submit" class="btn btn-primary">创建版块</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- 编辑版块模态框 -->
<div class="modal fade" id="editSectionModal" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title"><i class="fas fa-edit"></i> 编辑版块</h4>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true"><i class="fas fa-times"></i></span>
                </button>
            </div>
            <div class="modal-body">
                <form id="editSectionForm" action="#" method="POST">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                    <input type="hidden" id="editSectionId" name="section_id">
                    
                    <div class="form-group">
                        <label for="editName" class="form-label">版块名称</label>
                        <input type="text" id="editName" name="name" class="form-control" required placeholder="输入版块名称...">
                    </div>
                    
                    <div class="form-group">
                        <label for="editDescription" class="form-label">描述</label>
                        <textarea id="editDescription" name="description" class="form-control" rows="3" required placeholder="描述版块的主题和用途..."></textarea>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group col-md-6">
                            <label for="editIcon" class="form-label">图标</label>
                            <div class="icon-selector">
                                <div class="selected-icon" id="editSelectedIcon">
                                    <i class="fas fa-layer-group"></i>
                                </div>
                                <input type="hidden" id="editIcon" name="icon" value="layer-group">
                                <button type="button" class="btn btn-light" id="editSelectIconBtn">
                                    <i class="fas fa-chevron-down"></i>
                                </button>
                            </div>
                            <div class="icon-popup" id="editIconPopup">
                                <div class="icon-search">
                                    <input type="text" placeholder="搜索图标..." id="editIconSearchInput">
                                </div>
                                <div class="icon-grid">
                                    <div class="icon-item" data-icon="layer-group">
                                        <i class="fas fa-layer-group"></i>
                                    </div>
                                    <div class="icon-item" data-icon="comments">
                                        <i class="fas fa-comments"></i>
                                    </div>
                                    <div class="icon-item" data-icon="code">
                                        <i class="fas fa-code"></i>
                                    </div>
                                    <div class="icon-item" data-icon="book">
                                        <i class="fas fa-book"></i>
                                    </div>
                                    <div class="icon-item" data-icon="laptop-code">
                                        <i class="fas fa-laptop-code"></i>
                                    </div>
                                    <div class="icon-item" data-icon="lightbulb">
                                        <i class="fas fa-lightbulb"></i>
                                    </div>
                                    <div class="icon-item" data-icon="users">
                                        <i class="fas fa-users"></i>
                                    </div>
                                    <div class="icon-item" data-icon="graduation-cap">
                                        <i class="fas fa-graduation-cap"></i>
                                    </div>
                                    <div class="icon-item" data-icon="coffee">
                                        <i class="fas fa-coffee"></i>
                                    </div>
                                    <div class="icon-item" data-icon="gamepad">
                                        <i class="fas fa-gamepad"></i>
                                    </div>
                                    <div class="icon-item" data-icon="chart-line">
                                        <i class="fas fa-chart-line"></i>
                                    </div>
                                    <div class="icon-item" data-icon="paint-brush">
                                        <i class="fas fa-paint-brush"></i>
                                    </div>
                                    <div class="icon-item" data-icon="music">
                                        <i class="fas fa-music"></i>
                                    </div>
                                    <div class="icon-item" data-icon="camera">
                                        <i class="fas fa-camera"></i>
                                    </div>
                                    <div class="icon-item" data-icon="film">
                                        <i class="fas fa-film"></i>
                                    </div>
                                    <div class="icon-item" data-icon="globe">
                                        <i class="fas fa-globe"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-group col-md-6">
                            <label for="editIconColor" class="form-label">颜色</label>
                            <div class="color-selector">
                                <div class="selected-color" id="editSelectedColor" style="background-color: #5e72e4;"></div>
                                <input type="hidden" id="editIconColor" name="icon_color" value="#5e72e4">
                                <div class="color-options">
                                    <div class="color-option" data-color="#5e72e4" style="background-color: #5e72e4;"></div>
                                    <div class="color-option" data-color="#2dce89" style="background-color: #2dce89;"></div>
                                    <div class="color-option" data-color="#fb6340" style="background-color: #fb6340;"></div>
                                    <div class="color-option" data-color="#11cdef" style="background-color: #11cdef;"></div>
                                    <div class="color-option" data-color="#f5365c" style="background-color: #f5365c;"></div>
                                    <div class="color-option" data-color="#8965e0" style="background-color: #8965e0;"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="editSortOrder" class="form-label">排序顺序</label>
                        <input type="number" id="editSortOrder" name="sort_order" class="form-control" value="0" min="0">
                        <div class="form-text">数字越小，排序越靠前</div>
                    </div>
                    
                    <div class="form-group">
                        <div class="checkbox-wrapper">
                            <input type="checkbox" id="editIsActive" name="is_active" class="custom-checkbox" checked>
                            <label for="editIsActive"></label>
                            <span class="checkbox-label">版块可见</span>
                        </div>
                        <div class="form-text ml-4">若不勾选，版块将在前台隐藏</div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-light" data-dismiss="modal">
                    <i class="fas fa-times"></i> 取消
                </button>
                <button type="submit" form="editSectionForm" class="btn btn-primary">
                    <i class="fas fa-check"></i> 保存更改
                </button>
            </div>
        </div>
    </div>
</div>

<style>
    /* 数据统计卡片 */
    .stats-cards {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 1.5rem;
        margin-bottom: 2rem;
    }
    
    .stat-card {
        background-color: white;
        border-radius: 12px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        padding: 1.5rem;
        display: flex;
        align-items: center;
        justify-content: space-between;
    }
    
    .stat-card-icon {
        width: 48px;
        height: 48px;
        border-radius: 12px;
        background-color: rgba(45, 206, 137, 0.1);
        color: #2dce89;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 20px;
    }
    
    .stat-card-content {
        flex: 1;
        margin-left: 1rem;
    }
    
    .stat-card-value {
        font-size: 1.75rem;
        font-weight: 600;
        color: #344767;
        margin-bottom: 0.25rem;
    }
    
    .stat-card-label {
        font-size: 0.875rem;
        color: #67748e;
    }
    
    .stat-card-chart {
        color: var(--gray-400);
        font-size: 1.5rem;
        margin-left: 1rem;
    }
    
    /* 功能区 */
    .function-bar {
        display: flex;
        flex-wrap: wrap;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 1.5rem;
        gap: 1rem;
        background-color: white;
        border-radius: 12px;
        padding: 1rem;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
    }
    
    .search-box {
        position: relative;
        flex: 1;
        min-width: 240px;
    }
    
    .search-box input {
        padding: 0.625rem 1rem 0.625rem 2.5rem;
        border: 1px solid #e9ecef;
        border-radius: 8px;
        width: 100%;
    }
    
    .search-box i {
        position: absolute;
        left: 1rem;
        top: 50%;
        transform: translateY(-50%);
        color: #a0aec0;
    }
    
    .filters {
        display: flex;
        gap: 0.75rem;
    }
    
    .dropdown {
        position: relative;
    }
    
    .dropdown-toggle {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.625rem 1rem;
        border: 1px solid #e9ecef;
        border-radius: 8px;
        background-color: white;
        cursor: pointer;
        transition: all 0.2s ease;
    }
    
    .dropdown:hover .dropdown-menu {
        display: block;
    }
    
    .dropdown-menu {
        display: none;
        position: absolute;
        top: 100%;
        right: 0;
        min-width: 180px;
        background-color: white;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        padding: 0.5rem 0;
        z-index: 100;
    }
    
    .dropdown-item {
        display: block;
        padding: 0.5rem 1rem;
        color: #67748e;
        text-decoration: none;
        transition: all 0.2s ease;
    }
    
    .dropdown-item:hover {
        background-color: #f8f9fa;
    }
    
    .dropdown-item.active {
        background-color: #263849;
        color: white;
    }
    
    .actions {
        margin-left: auto;
    }
    
    /* 版块分析模态框 */
    .analytics-header {
        display: flex;
        justify-content: space-between;
        margin-bottom: 1.5rem;
    }
    
    .time-range {
        display: flex;
        gap: 0.5rem;
    }
    
    .analytics-cards {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 1.5rem;
        margin-bottom: 1.5rem;
    }
    
    .analytics-card {
        background: white;
        border-radius: var(--border-radius-md);
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
        padding: 1rem;
        display: flex;
        align-items: center;
        border: 1px solid var(--gray-200);
    }
    
    .analytics-card-icon {
        width: 36px;
        height: 36px;
        border-radius: var(--border-radius-sm);
        background: rgba(38, 56, 73, 0.1);
        color: rgb(38, 56, 73);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1rem;
        margin-right: 0.75rem;
    }
    
    .analytics-card-content {
        flex: 1;
    }
    
    .analytics-card-value {
        font-size: 1.25rem;
        font-weight: 600;
        color: var(--gray-900);
        line-height: 1.2;
    }
    
    .analytics-card-label {
        font-size: 0.75rem;
        color: var(--gray-500);
    }
    
    .analytics-card-change {
        font-size: 0.75rem;
        font-weight: 500;
        padding: 0.25rem 0.5rem;
        border-radius: var(--border-radius-full);
        margin-left: 0.5rem;
    }
    
    .analytics-card-change.positive {
        background: rgba(76, 175, 80, 0.1);
        color: var(--success);
    }
    
    .analytics-card-change.negative {
        background: rgba(244, 67, 54, 0.1);
        color: var(--danger);
    }
    
    .analytics-charts {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 1.5rem;
    }
    
    .chart-container {
        background: white;
        border-radius: var(--border-radius-md);
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
        padding: 1rem;
        border: 1px solid var(--gray-200);
    }
    
    .chart-title {
        font-size: 0.875rem;
        font-weight: 600;
        color: var(--gray-700);
        margin-bottom: 1rem;
    }
    
    .chart {
        height: 250px;
        position: relative;
    }
    
    .chart-placeholder {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        color: var(--gray-400);
        font-size: 1.25rem;
    }
    
    .chart-placeholder span {
        font-size: 0.875rem;
        margin-top: 0.5rem;
    }

    /* 自定义按钮样式 */
    .btn-primary {
        background: linear-gradient(to right, rgb(38, 56, 73), rgb(48, 66, 83));
        border-color: rgb(38, 56, 73);
        color: white;
        font-weight: 500;
        padding: 8px 16px;
        box-shadow: 0 2px 6px rgba(38, 56, 73, 0.3);
        transition: all 0.2s ease;
    }
    
    .btn-primary:hover {
        background: linear-gradient(to right, rgb(28, 46, 63), rgb(38, 56, 73));
        box-shadow: 0 4px 10px rgba(38, 56, 73, 0.4);
        transform: translateY(-1px);
    }
    
    .btn-primary:active, .btn-primary:focus {
        background: rgb(28, 46, 63);
        box-shadow: 0 1px 3px rgba(38, 56, 73, 0.2);
        transform: translateY(1px);
    }
    
    .btn-light {
        background-color: #f8f9fa;
        border-color: #e9ecef;
        color: #495057;
        font-weight: 500;
        padding: 8px 16px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
        transition: all 0.2s ease;
    }
    
    .btn-light:hover {
        background-color: #e9ecef;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    }
    
    .btn-danger {
        background: linear-gradient(135deg, #d43c31 0%, #f44336 100%);
        border-color: #d43c31;
        font-weight: 500;
        box-shadow: 0 2px 6px rgba(244, 67, 54, 0.3);
        transition: all 0.2s ease;
    }
    
    .btn-danger:hover {
        background: linear-gradient(135deg, #c23529 0%, #e53935 100%);
        box-shadow: 0 4px 10px rgba(244, 67, 54, 0.4);
        transform: translateY(-1px);
    }
    
    .btn-warning {
        background: linear-gradient(135deg, #fb8c00 0%, #ffa726 100%);
        border-color: #fb8c00;
        font-weight: 500;
        box-shadow: 0 2px 6px rgba(255, 152, 0, 0.3);
        transition: all 0.2s ease;
    }
    
    .btn-warning:hover {
        background: linear-gradient(135deg, #ef6c00 0%, #ff9800 100%);
        box-shadow: 0 4px 10px rgba(255, 152, 0, 0.4);
        transform: translateY(-1px);
    }
    
    .btn-success {
        background: linear-gradient(135deg, #2e7d32 0%, #43a047 100%);
        border-color: #2e7d32;
        font-weight: 500;
        box-shadow: 0 2px 6px rgba(76, 175, 80, 0.3);
        transition: all 0.2s ease;
    }
    
    .btn-success:hover {
        background: linear-gradient(135deg, #256b2c 0%, #388e3c 100%);
        box-shadow: 0 4px 10px rgba(76, 175, 80, 0.4);
        transform: translateY(-1px);
    }

    /* 表单样式 */
    .form-group {
        margin-bottom: 1.5rem;
    }
    
    .form-label {
        font-weight: 500;
        margin-bottom: 0.5rem;
        display: block;
        color: var(--gray-700);
    }
    
    .form-control {
        border: 1px solid var(--gray-300);
        border-radius: var(--border-radius-md);
        padding: 0.5rem 0.75rem;
        font-size: 0.875rem;
        transition: all 0.15s ease;
    }
    
    .form-control:focus {
        border-color: rgb(38, 56, 73);
        box-shadow: 0 0 0 3px rgba(38, 56, 73, 0.1);
    }
    
    .form-text {
        font-size: 0.75rem;
        color: var(--gray-500);
        margin-top: 0.375rem;
    }
    
    /* 复选框样式 */
    .checkbox-wrapper {
        position: relative;
        display: inline-block;
    }
    
    .custom-checkbox {
        position: absolute;
        opacity: 0;
        cursor: pointer;
        height: 0;
        width: 0;
    }
    
    .checkbox-wrapper label {
        position: relative;
        cursor: pointer;
        padding-left: 25px;
        text-align: center;
        color: #555;
        display: inline-block;
        font-size: 13px;
    }
    
    .checkbox-wrapper label:before {
        content: '';
        position: absolute;
        left: 0;
        top: 0;
        width: 18px;
        height: 18px;
        border: 1px solid #ddd;
        border-radius: 3px;
        background: #fff;
    }
    
    .custom-checkbox:checked + label:after {
        content: '';
        position: absolute;
        left: 6px;
        top: 3px;
        width: 6px;
        height: 10px;
        border: solid rgb(38, 56, 73);
        border-width: 0 2px 2px 0;
        transform: rotate(45deg);
    }
    
    .custom-checkbox:indeterminate + label:after {
        content: '';
        position: absolute;
        left: 4px;
        top: 8px;
        width: 10px;
        height: 2px;
        background-color: rgb(38, 56, 73);
    }
    
    .checkbox-label {
        margin-left: 0.5rem;
        font-size: 0.875rem;
    }
    
    /* 图标选择器 */
    .icon-selector {
        position: relative;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }
    
    .selected-icon {
        width: 42px;
        height: 42px;
        border-radius: var(--border-radius-md);
        background: var(--gray-100);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.25rem;
        color: var(--gray-700);
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }
    
    .icon-popup {
        position: absolute;
        top: calc(100% + 5px);
        left: 0;
        width: 250px;
        background: white;
        border-radius: var(--border-radius-md);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        padding: 1rem;
        z-index: 10;
        display: none;
    }
    
    .icon-popup.show {
        display: block;
        animation: fadeIn 0.2s ease;
    }
    
    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(-10px); }
        to { opacity: 1; transform: translateY(0); }
    }
    
    .icon-search {
        margin-bottom: 0.75rem;
        position: relative;
    }
    
    .icon-search input {
        width: 100%;
        padding: 0.5rem 0.75rem 0.5rem 2rem;
        font-size: 0.75rem;
        border: 1px solid var(--gray-300);
        border-radius: var(--border-radius-md);
    }
    
    .icon-search:before {
        content: "\f002";
        font-family: "Font Awesome 5 Free";
        font-weight: 900;
        position: absolute;
        left: 0.75rem;
        top: 50%;
        transform: translateY(-50%);
        color: var(--gray-500);
        font-size: 0.75rem;
    }
    
    .icon-grid {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 0.5rem;
        max-height: 200px;
        overflow-y: auto;
    }
    
    .icon-item {
        width: 36px;
        height: 36px;
        border-radius: var(--border-radius-md);
        background: var(--gray-100);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1rem;
        color: var(--gray-700);
        cursor: pointer;
        transition: all 0.15s ease;
    }
    
    .icon-item:hover {
        background: rgb(38, 56, 73);
        color: white;
        transform: scale(1.05);
    }
    
    .icon-item.selected {
        background: rgb(38, 56, 73);
        color: white;
        box-shadow: 0 2px 5px rgba(38, 56, 73, 0.3);
    }
    
    /* 颜色选择器 */
    .color-selector {
        display: flex;
        align-items: center;
        gap: 0.75rem;
    }
    
    .selected-color {
        width: 42px;
        height: 42px;
        border-radius: var(--border-radius-md);
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }
    
    .color-options {
        display: flex;
        gap: 0.5rem;
        flex-wrap: wrap;
    }
    
    .color-option {
        width: 26px;
        height: 26px;
        border-radius: var(--border-radius-full);
        cursor: pointer;
        transition: all 0.15s ease;
        border: 2px solid transparent;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }
    
    .color-option:hover {
        transform: scale(1.1);
    }
    
    .color-option.selected {
        border-color: var(--gray-900);
        box-shadow: 0 0 0 2px white, 0 0 0 4px var(--gray-300);
    }
    
    /* 表单布局 */
    .form-row {
        display: flex;
        margin: 0 -0.75rem;
    }
    
    .col-md-6 {
        padding: 0 0.75rem;
        width: 50%;
    }
    
    @media (max-width: 768px) {
        .form-row {
            flex-direction: column;
        }
        
        .col-md-6 {
            width: 100%;
            margin-bottom: 1rem;
        }
    }
    
    /* 模态框样式 */
    .modal-content {
        border: none;
        border-radius: var(--border-radius-lg);
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        overflow: hidden;
        transform: translateY(-20px);
        opacity: 0;
        transition: all 0.3s ease;
    }
    
    .modal-header {
        background: linear-gradient(to right, rgb(38, 56, 73), rgb(58, 76, 93));
        color: white;
        border-bottom: none;
        padding: 1.5rem;
    }
    
    .modal-title {
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 0.75rem;
        color: white;
    }
    
    .modal-title i {
        font-size: 1.25rem;
        color: white;
    }
    
    .modal-header .close {
        color: white;
        opacity: 0.8;
        text-shadow: none;
        transition: opacity 0.15s ease;
        background: transparent;
        border: none;
        font-size: 1.5rem;
        padding: 0;
        margin: -1rem -1rem -1rem auto;
        line-height: 1;
        float: right;
    }
    
    .modal-header .close:hover {
        opacity: 1;
        color: white;
    }
    
    .modal-header .close i {
        color: white;
    }
    
    .modal-body {
        padding: 1.75rem;
    }
    
    .modal-footer {
        border-top: 1px solid var(--gray-200);
        padding: 1.25rem 1.75rem;
    }
    
    /* 确保模态框中的按钮都有正确的文本颜色 */
    .modal-footer .btn {
        font-weight: 500;
    }
    
    .modal-footer .btn-primary {
        color: white;
    }
    
    .modal-footer .btn-light {
        color: #495057;
    }
    
    /* 添加左边距样式 */
    .ml-4 {
        margin-left: 1.5rem;
    }

    /* 响应式调整 */
    @media (max-width: 992px) {
        .stats-cards {
            grid-template-columns: repeat(2, 1fr);
        }
    }

    @media (max-width: 576px) {
        .stats-cards {
            grid-template-columns: 1fr;
        }
    }
</style>

{% endblock %}

{% block scripts %}
<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="{{ url_for('static', filename='js/admin-sections.js') }}"></script>
{% endblock %} 